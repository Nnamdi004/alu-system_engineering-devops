#!/usr/bin/env bash
# Configures Nginx with a custom HTTP response header
# The custom header is X-Served-By with the value set to the server's hostname

# Update package list and install Nginx if not already installed
apt-get update -y
apt-get install -y nginx

# Get the hostname of the server
HOSTNAME=$(hostname)

# Configure Nginx to add custom header
# We'll add the header configuration to the http block in nginx.conf
HEADER_CONFIG="add_header X-Served-By $HOSTNAME;"

# Check if the custom header already exists in the config
if ! grep -q "X-Served-By" /etc/nginx/nginx.conf; then
    # Add the custom header to the http block
    sed -i "/http {/a \\\t$HEADER_CONFIG" /etc/nginx/nginx.conf
fi

# Ensure Nginx is enabled and restart it to apply changes
systemctl enable nginx
systemctl restart nginx
